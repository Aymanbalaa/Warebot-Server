<!DOCTYPE html>
<html>
<head>
    <title>Warebot Control Panel</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #121212; color: #e0e0e0; display: flex; height: 100vh; }
        .panel { padding: 20px; border-right: 1px solid #333; width: 300px; }
        .viewer { flex-grow: 1; padding: 20px; }
        h1, h2 { border-bottom: 1px solid #444; padding-bottom: 10px; }
        pre { background-color: #1e1e1e; border: 1px solid #333; padding: 15px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; }
        input { width: calc(100% - 20px); padding: 8px; margin-bottom: 10px; background-color: #333; border: 1px solid #555; color: #e0e0e0; border-radius: 3px; }
        button { width: 100%; padding: 10px; background-color: #007bff; border: none; color: white; border-radius: 3px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        #status { font-weight: bold; }
    </style>
</head>
<body>
    <div class="panel">
        <h1>Warebot Control</h1>
        <p>Connection: <span id="status">Connecting...</span></p>

        <h2>Live State</h2>
        <pre id="data">Waiting for data...</pre>

        <h2>Send Nav Goal</h2>
        <form id="goalForm">
            <input type="number" id="x_coord" placeholder="X coordinate" step="0.1" required>
            <input type="number" id="y_coord" placeholder="Y coordinate" step="0.1" required>
            <button type="submit">Send Goal</button>
        </form>
        <p id="form_status"></p>
    </div>
    <div class="viewer">
        <h2>Map Viewer (Placeholder)</h2>
        <p>This is where your ros2d.js map would be rendered.</p>
    </div>

    <script>
        const statusElement = document.getElementById("status");
        const dataElement = document.getElementById("data");
        const goalForm = document.getElementById("goalForm");
        const xCoordInput = document.getElementById("x_coord");
        const yCoordInput = document.getElementById("y_coord");
        const formStatus = document.getElementById("form_status");

        // --- WebSocket for Live Data ---
        const socket = new WebSocket(`ws://${window.location.host}/ws`);
        socket.onopen = () => { statusElement.textContent = "Connected"; statusElement.style.color = "#4caf50"; };
        socket.onclose = () => { statusElement.textContent = "Disconnected"; statusElement.style.color = "#f44336"; };
        socket.onmessage = (event) => {
            const jsonData = JSON.parse(event.data);
            dataElement.textContent = JSON.stringify(jsonData, null, 2);
        };

        // --- Form submission for sending goals ---
        goalForm.addEventListener("submit", async (event) => {
            event.preventDefault();
            const goal = {
                x: parseFloat(xCoordInput.value),
                y: parseFloat(yCoordInput.value)
            };
            
            formStatus.textContent = "Sending goal...";
            try {
                const response = await fetch('/api/robot/goals', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(goal)
                });
                const result = await response.json();
                formStatus.textContent = `Server: ${result.message}`;
                formStatus.style.color = (result.status === 'success') ? '#4caf50' : '#f44336';
            } catch (error) {
                formStatus.textContent = "Error sending request.";
                formStatus.style.color = '#f44336';
            }
        });
    </script>
</body>
</html>